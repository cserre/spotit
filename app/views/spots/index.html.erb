<!-- set max and min price, max and min area for the city selected -->
<% prices = [] %>
<% areas = [] %>
<% @spots.each do |spot| %>
  <% if spot.visible && ((@params["city"].nil? || @params["city"] == "") ? true : spot.city.downcase == @params["city"].downcase) %>
    <% prices << spot.price %>
    <% areas << spot.area %>
  <% end %>
<% end %>
<% max_price = prices.sort.last.to_i %>
<% min_price = prices.sort.first.to_i %>
<% max_area = areas.sort.last.to_i %>
<% min_area = areas.sort.first.to_i %>

<!-- find all spots macthing criteria -->


<div class="sidebar sidebar-padded">
  <!-- form to add specific filters and refresh this page -->
  <div class="row">
    <div class="col-xs-12">
      <%= form_tag(spots_path, method: 'get') do %>
        <div class="row">
          <div class="col-sm-7">
            <div class="form-group">
              <%= label_tag :price, "Max price:" %>
              <%= text_field_tag :price, nil, class: 'slider-price span2', data: { :"slider-id" => 'slider-price', :"slider-min" => min_price, :"slider-max" => max_price, :"slider-step" => 100, :"slider-value" => max_price } %>
            </div>
            <div class="form-group">
              <%= label_tag :area, "Min area:" %>
              <%= text_field_tag :area, nil, class: 'slider-area span2', data: { :"slider-id" => 'slider-area', :"slider-min" => min_area, :"slider-max" => max_area, :"slider-step" => 1, :"slider-value" => min_area, :"slider-selection" => "after"} %>
            </div>
            <div class="form-group form-inline">
              <!-- <%= label_tag :city, "City:" %> -->
              <%= hidden_field_tag :city, @params["city"], class: 'form-control' %>
            </div>
          </div>
          <div class="col-md-5">
            <div class="form-group">
              <%= label_tag :exceptional_view, "Exceptional view:" %>
              <%= check_box_tag :exceptional_view, checked: false, class: 'form-control' %>
            </div>
            <div class="form-group">
              <%= label_tag :modular_furniture, "Modular furniture:" %>
              <%= check_box_tag :modular_furniture, checked: false, class: 'form-control' %>
            </div>
          </div>
          <div class="text-center">
            <%= submit_tag "Find", class: 'btn btn-primary' %>
          </div>
        </div>

      <% end %>
    </div>
  </div>


  <!-- show all spots according to filters -->
  <div class="row">
    <div class="col-xs-12" style="padding-top: 30px;">
      <p>Find your perfect shooting place in <%= @params["city"].capitalize %> :</p>
    </div>

    <% @spots_selected.each do |spot| %>
      <div class="col-md-6">
        <div class="card">
          <span class="card-bg" style="background-image: url(<%= image_path 'loft1.png' %>)"></span>
          <span class="card-gradient"></span>
          <!-- <span class="card-rating">

            <%= ("<i class='fa fa-star' style='color: #FFCE54;'></i>" * 4).html_safe %>
          </span> -->
          <span class="card-price">
            <%= spot.price.to_i.to_s + ' â‚¬/day' %>
          </span>
          <%= link_to "", spot_path(spot),class: 'card-link' %>
        </div>
        <div class="card-detail">
          <div class="title"><%= spot.title %></div>
        </div>

      </div>
    <% end %>
    <%= paginate @spots_selected %>
  </div>
</div>
<!-- block for map -->

<div id="map">MAP</div>


<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js&key=AIzaSyAWJWKuKsqT_xm8Z2qtMvu2s0d1TLAIeoc"></script>

<script type="text/javascript">
  var myLatlng = new google.maps.LatLng(48.852937,2.364178);
  // var myLatlng2 = new google.maps.LatLng(48.852,2.364178);
  var myOptions = {
    zoom: 16,
    center: myLatlng,
    scrollwheel: false,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    styles: [
  {
      "featureType": "administrative",
      "elementType": "labels.text.fill",
      "stylers": [
          {
              "color": "#444444"
          }
      ]
  },
  {
      "featureType": "landscape",
      "elementType": "all",
      "stylers": [
          {
              "color": "#f2f2f2"
          }
      ]
  },
  {
      "featureType": "poi",
      "elementType": "all",
      "stylers": [
          {
              "visibility": "off"
          }
      ]
  },
  {
      "featureType": "road",
      "elementType": "all",
      "stylers": [
          {
              "saturation": -100
          },
          {
              "lightness": 45
          }
      ]
  },
  {
      "featureType": "road.highway",
      "elementType": "all",
      "stylers": [
          {
              "visibility": "simplified"
          }
      ]
  },
  {
      "featureType": "road.arterial",
      "elementType": "labels.icon",
      "stylers": [
          {
              "visibility": "off"
          }
      ]
  },
  {
      "featureType": "transit",
      "elementType": "all",
      "stylers": [
          {
              "visibility": "off"
          }
      ]
  },
  {
      "featureType": "water",
      "elementType": "all",
      "stylers": [
          {
              "color": "#2c3e50"
          },
          {
              "visibility": "on"
          }
      ]
  }
  ]
  };
  var map = new google.maps.Map(document.getElementById('map'), myOptions);
  var marker = new google.maps.Marker({
    position: myLatlng,
    map: map,
    title: "You are here!"
  });
  // var marker = new google.maps.Marker({
  //   position: myLatlng2,
  //   map: map,
  //   title: "You are here!"
  // });
</script>

<%= content_for(:after_js) do %>
  <%= javascript_tag do %>
    var sliderPrice = $('.slider-price').slider();
    var sliderArea = $('.slider-area').slider();
    <% if @params["price"].to_i > 0 %>
      var valuePrice = <%= @params["price"].to_i %>;
      sliderPrice.slider('setValue', valuePrice);
    <% end %>
    <% if @params["area"].to_i > 0 %>
      var valueArea = <%= @params["area"].to_i %>;
      sliderArea.slider('setValue', valueArea);
    <% end %>
  <% end %>
<% end %>



